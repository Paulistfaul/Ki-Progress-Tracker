<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>KI Progress Tracker</title>
  <link rel="manifest" href="manifest.json">
  <style>
    body { font-family: sans-serif; margin: 1rem; }
    #xp, #monthProgress, #level { margin-bottom: 0.5rem; font-size: 1.2rem; }
    #calendar { display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; margin-bottom: 1rem; }
    .day { border: 1px solid #ccc; padding: 0.5rem; text-align: center; cursor: pointer; }
    .past.missed { background: #fdd; }
    .past.done { background: #cfc; }
    #tasksInput { width: 100%; height: 4rem; margin-bottom: 0.5rem; }
    #tasksList { margin-bottom: 1rem; }
    button { padding: 0.5rem 1rem; margin-right: 0.5rem; }
  </style>
</head>
<body>
  <script>
    // Passwort-Prüfung
    if (!localStorage.getItem('pwVerified')) {
      const pw = prompt('Passwort eingeben:');
      if (pw !== '2610') {
        alert('Falsches Passwort');
        throw 'Abbruch';
      }
      localStorage.setItem('pwVerified', 'true');
    }
    // Startdatum setzen
    if (!localStorage.getItem('startDate')) {
      localStorage.setItem('startDate', new Date().toISOString());
    }
    const startDate = new Date(localStorage.getItem('startDate'));
    const now = new Date();
    // Monat berechnen (1-10)
    const diffDays = Math.floor((now - startDate) / (1000*60*60*24));
    const currentMonth = Math.min(10, Math.floor(diffDays/30) + 1);
    // Level berechnen
    const levelIndex = Math.min(6, Math.ceil(currentMonth/(10/6)));
    const levels = ['Anfänger','Amateur','Fortgeschrittener','Profi','Second AI Product Owner','AI Product Owner'];
    document.write(`<div id="xp">XP: ${diffDays * 100} / ${diffDays * 100}</div>`);
    document.write(`<div id="monthProgress">Monat: ${currentMonth} / 10</div>`);
    document.write(`<div id="level">Level: ${levels[levelIndex-1]}</div>`);
  </script>
  <div id="calendar"></div>
  <textarea id="tasksInput" placeholder="Quests hier einfügen..."></textarea><br>
  <button id="importTasksBtn">Quests importieren</button>
  <div id="tasksList"></div>
  <script>
    const calendarEl = document.getElementById('calendar');
    const today = new Date();
    const year = today.getFullYear();
    const month = today.getMonth();
    const daysInMonth = new Date(year, month+1, 0).getDate();
    const records = JSON.parse(localStorage.getItem('records') || '{}');
    function renderCalendar() {
      calendarEl.innerHTML = '';
      for (let d=1; d<=daysInMonth; d++) {
        const dateStr = `${year}-${String(month+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
        const dayEl = document.createElement('div');
        dayEl.classList.add('day');
        dayEl.textContent = d;
        if (new Date(dateStr) < new Date().setHours(0,0,0,0)) {
          dayEl.classList.add('past');
          if (records[dateStr] === true) dayEl.classList.add('done');
          else dayEl.classList.add('missed');
        }
        dayEl.addEventListener('click', () => {
          records[dateStr] = !records[dateStr];
          localStorage.setItem('records', JSON.stringify(records));
          renderCalendar();
        });
        calendarEl.appendChild(dayEl);
      }
    }
    renderCalendar();
    document.getElementById('importTasksBtn').addEventListener('click', () => {
      const lines = document.getElementById('tasksInput').value.split('\n').filter(l => l.trim());
      if (!lines.length) return;
      const todayStr = `${year}-${String(month+1).padStart(2,'0')}-${String(today.getDate()).padStart(2,'0')}`;
      const tasks = JSON.parse(localStorage.getItem('tasks') || '{}');
      tasks[todayStr] = lines;
      localStorage.setItem('tasks', JSON.stringify(tasks));
      renderTasks();
      records[todayStr] = true;
      localStorage.setItem('records', JSON.stringify(records));
      renderCalendar();
    });
    function renderTasks() {
      const tasksDiv = document.getElementById('tasksList');
      const tasks = JSON.parse(localStorage.getItem('tasks') || '{}');
      const todayStr = `${year}-${String(month+1).padStart(2,'0')}-${String(today.getDate()).padStart(2,'0')}`;
      tasksDiv.innerHTML = (tasks[todayStr] || []).map(t => `<div>• ${t}</div>`).join('');
    }
    renderTasks();
  </script>
</body>
</html>
