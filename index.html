<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>KI Progress Tracker</title>
  <link rel="manifest" href="manifest.json" />
  <script src="https://apis.google.com/js/api.js"></script>
  <style>
    body { font-family: sans-serif; padding: 1rem; }
    h1 { font-size: 1.5rem; margin-bottom: 0.5rem; }
    #xp, #monthProgress, #level { margin-bottom: 0.5rem; }
    #calendar { display: grid; grid-template-columns: repeat(7,1fr); gap:5px; margin-bottom:1rem; }
    .day { border:1px solid #ccc; padding:0.5rem; text-align:center; cursor:pointer; }
    .day.past.missed { background:#fdd; }
    .day.past.done { background:#cfc; }
    #controls { margin-bottom:1rem; }
    #taskForm input, #taskForm button { margin:0.3rem 0; display:block; }
    #tasksList .task-item { display:flex; justify-content:space-between; margin-bottom:0.3rem; }
    button { padding:0.4rem 0.8rem; }
  </style>
</head>
<body>
  <h1>KI Progress Tracker</h1>
  <div id="controls">
    <button id="authorize_button">Google Calendar verbinden</button>
    <button id="signout_button" style="display:none">Abmelden</button>
  </div>
  <div id="status"></div>
  <div id="xp"></div><div id="monthProgress"></div><div id="level"></div>
  <div id="calendar"></div>

  <div id="taskSection" style="display:none;">
    <button id="backBtn">Zurück zur Übersicht</button>
    <form id="taskForm">
      <input type="text" id="taskDesc" placeholder="Aufgabe Beschreibung" required />
      <input type="date" id="taskDate" required />
      <input type="time" id="taskTime" required />
      <button type="submit">Aufgabe hinzufügen</button>
    </form>
    <div id="tasksList"></div>
  </div>

  <script>
    // Passwortabfrage
    if (!localStorage.getItem("pwVerified")) {
      const pw = prompt("Passwort eingeben:");
      if (pw !== "2610") { alert("Falsches Passwort"); throw "Abbruch"; }
      localStorage.setItem("pwVerified","true");
    }
    // Basisdaten
    if (!localStorage.getItem("startDate")) localStorage.setItem("startDate", new Date().toISOString());
    const startDate = new Date(localStorage.getItem("startDate"));
    const now = new Date();
    const diffDays = Math.floor((now - startDate)/(1000*60*60*24));
    const currentMonth = Math.min(10, Math.floor(diffDays/30)+1);
    const levelIndex = Math.min(6, Math.ceil(currentMonth/(10/6)));
    const levels=["Anfänger","Amateur","Fortgeschrittener","Profi","Second AI Product Owner","AI Product Owner"];
    document.getElementById('xp').textContent = `XP: ${diffDays*100} / 1000`;
    document.getElementById('monthProgress').textContent = `Monat: ${currentMonth}/10`;
    document.getElementById('level').textContent = `Level: ${levels[levelIndex-1]}`;
    
    // Google API
    const CLIENT_ID = '<828803560489-gp7afdiddlv2iq10jttv48ufqrva7d27.apps.googleusercontent.com>'; // hier ersetzen
    const API_KEY = '<AIzaSyASHlFIrs6AAxbO_Ac1utyBQqHLD6em_hQ>';     // hier ersetzen
    const DISCOVERY_DOCS = ["https://www.googleapis.com/discovery/v1/apis/calendar/v3/rest"];
    const SCOPES = 'https://www.googleapis.com/auth/calendar.events';
    
    const authorizeButton = document.getElementById('authorize_button');
    const signoutButton = document.getElementById('signout_button');
    const statusEl = document.getElementById('status');
    
    function handleClientLoad() { gapi.load('client:auth2', initClient); }
    function initClient() {
      gapi.client.init({apiKey:API_KEY,clientId:CLIENT_ID,discoveryDocs:DISCOVERY_DOCS,scope:SCOPES})
      .then(() => {
        gapi.auth2.getAuthInstance().isSignedIn.listen(updateSigninStatus);
        updateSigninStatus(gapi.auth2.getAuthInstance().isSignedIn.get());
        authorizeButton.onclick = () => gapi.auth2.getAuthInstance().signIn();
        signoutButton.onclick = () => gapi.auth2.getAuthInstance().signOut();
      });
    }
    function updateSigninStatus(isSignedIn) {
      if (isSignedIn) {
        authorizeButton.style.display='none'; signoutButton.style.display='inline-block'; statusEl.textContent='Verbunden mit Google Calendar';
      } else {
        authorizeButton.style.display='inline-block'; signoutButton.style.display='none'; statusEl.textContent='Nicht verbunden';
      }
    }
    
    // Kalender & Tasks
    const calendarEl=document.getElementById('calendar');
    const taskSection=document.getElementById('taskSection');
    let selectedDate=null;
    const records=JSON.parse(localStorage.getItem('records')||'{}');
    const tasks=JSON.parse(localStorage.getItem('tasks')||'{}');
    const tasksDone=JSON.parse(localStorage.getItem('tasksDone')||'{}');
    
    function renderCalendar() {
      calendarEl.innerHTML='';
      for(let d=1;d<=new Date(now.getFullYear(),now.getMonth()+1,0).getDate();d++){
        const day=new Date(now.getFullYear(),now.getMonth(),d);
        const dateStr=day.toISOString().slice(0,10);
        const el=document.createElement('div'); el.className='day'; el.textContent=d;
        const past=day<new Date().setHours(0,0,0,0);
        if(past) el.classList.add('past');
        if(records[dateStr]) el.classList.add('done');
        else if(past) el.classList.add('missed');
        el.onclick=()=>openTasks(dateStr);
        el.ondblclick=()=>{
          if(past){ records[dateStr]=!records[dateStr]; localStorage.setItem('records',JSON.stringify(records)); renderCalendar(); }
        };
        calendarEl.appendChild(el);
      }
    }
    renderCalendar();
    
    function openTasks(dateStr){
      selectedDate=dateStr;
      calendarEl.style.display='none'; authorizeButton.style.display='none';
      taskSection.style.display='block';
      document.getElementById('taskDate').value=dateStr;
      renderTasks();
    }
    
    document.getElementById('backBtn').onclick=()=>{ calendarEl.style.display='grid'; authorizeButton.style.display=''; taskSection.style.display='none'; };
    
    document.getElementById('taskForm').onsubmit=e=>{
      e.preventDefault();
      const desc=document.getElementById('taskDesc').value;
      const date=document.getElementById('taskDate').value;
      const time=document.getElementById('taskTime').value;
      tasks[date]=tasks[date]||[]; tasks[date].push({desc,time});
      localStorage.setItem('tasks',JSON.stringify(tasks)); renderTasks();
    };
    
    function renderTasks(){
      const list=tasks[selectedDate]||[];
      const container=document.getElementById('tasksList'); container.innerHTML='';
      list.forEach((t,i)=>{
        const div=document.createElement('div'); div.className='task-item';
        const chk=document.createElement('input'); chk.type='checkbox'; chk.checked=tasksDone[selectedDate]?.[i];
        chk.onchange=()=>{ tasksDone[selectedDate]=tasksDone[selectedDate]||[]; tasksDone[selectedDate][i]=chk.checked; localStorage.setItem('tasksDone',JSON.stringify(tasksDone)); };
        const span=document.createElement('span'); span.textContent=`${t.desc} (${t.time})`;
        const addBtn=document.createElement('button'); addBtn.textContent='→ Calendar'; addBtn.onclick=()=>addEvent(t);
        div.append(chk,span,addBtn); container.appendChild(div);
      });
    }

    function addEvent(task){
      if(!gapi.auth2.getAuthInstance().isSignedIn.get()) return alert('Bitte zunächst verbinden');
      const event={ summary:task.desc, start:{ dateTime:`${selectedDate}T${task.time}:00`,timeZone:Intl.DateTimeFormat().resolvedOptions().timeZone }, end:{ dateTime:`${selectedDate}T${task.time}:00`,timeZone:Intl.DateTimeFormat().resolvedOptions().timeZone } };
      gapi.client.calendar.events.insert({ calendarId:'primary', resource:event }).then(()=>alert('Termin erstellt'));    
    }

    window.onload=handleClientLoad;
  </script>
</body>
</html>



