<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>KI Progress Tracker</title>
  <link rel="manifest" href="manifest.json" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <script src="https://apis.google.com/js/api.js"></script>
  <style>
    :root {
      --primary: #4CAF50;
      --secondary: #fff;
      --background: #f5f7fa;
      --card-bg: #fff;
      --text: #333;
      --muted: #777;
      --radius: 12px;
      --shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: 'Inter', sans-serif;
      background: var(--background);
      color: var(--text);
    }
    .container {
      max-width: 480px;
      margin: 0 auto;
      padding: 1rem;
    }
    header { text-align: center; margin-bottom: 1rem; }
    header h1 { font-size: 1.6rem; margin: .5rem 0; }
    .stats { display: flex; gap: .5rem; margin-bottom: 1rem; }
    .card {
      flex: 1;
      background: var(--card-bg);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: .75rem;
      text-align: center;
    }
    .card .value { font-size: 1.2rem; font-weight: 600; }
    .card .label { color: var(--muted); font-size: .85rem; }
    .controls { display: flex; gap: .5rem; justify-content: center; margin-bottom: 1rem; }
    button {
      background: var(--primary);
      color: var(--secondary);
      border: none;
      border-radius: var(--radius);
      padding: .6rem 1rem;
      font-weight: 600;
      box-shadow: var(--shadow);
      cursor: pointer;
      transition: background .3s;
    }
    button:hover { background: #43a047; }
    #calendar {
      display: grid;
      grid-template-columns: repeat(7,1fr);
      gap: 4px;
      margin-bottom: 1rem;
    }
    .day {
      background: var(--card-bg);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: .5rem;
      text-align: center;
      cursor: pointer;
      position: relative;
    }
    .day .date { font-weight: 600; }
    .day.past.missed { background: #fdecea; }
    .day.past.done { background: #e8f5e9; }
    #taskSection { display: none; background: var(--card-bg); padding: 1rem; border-radius: var(--radius); box-shadow: var(--shadow); }
    #taskForm input, #taskForm button { width: 100%; margin-bottom: .5rem; font-family: 'Inter', sans-serif; }
    .task-item { display: flex; align-items: center; justify-content: space-between; padding: .5rem; background: var(--background); border-radius: var(--radius); margin-bottom: .4rem; }
    .task-item span { flex: 1; margin-left: .5rem; }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>KI Progress Tracker</h1>
      <div class="stats">
        <div class="card"><div class="value" id="xp">-- XP</div><div class="label">XP</div></div>
        <div class="card"><div class="value" id="monthProgress">-- / 10</div><div class="label">Monat</div></div>
        <div class="card"><div class="value" id="level">--</div><div class="label">Level</div></div>
      </div>
    </header>
    <div class="controls">
      <button id="authorize_button">Calendar verbinden</button>
      <button id="signout_button" style="display:none;">Abmelden</button>
    </div>
    <div id="calendar"></div>
    <div id="taskSection">
      <button id="backBtn">Zurück zur Übersicht</button>
      <form id="taskForm">
        <input type="text" id="taskDesc" placeholder="Aufgabe Beschreibung" required />
        <input type="date" id="taskDate" required />
        <input type="time" id="taskTime" required />
        <button type="submit">Aufgabe hinzufügen</button>
      </form>
      <div id="tasksList"></div>
    </div>
  </div>

  <script>
    // Passwort & Startdatum
    if(!localStorage.getItem('pwVerified')){
      const pw=prompt('Passwort eingeben:'); if(pw!=='2610'){alert('Falsches Passwort');throw 'Abbruch';}
      localStorage.setItem('pwVerified','true');
    }
    if(!localStorage.getItem('startDate')) localStorage.setItem('startDate',new Date().toISOString());

    // Stats berechnen
    const startDate=new Date(localStorage.getItem('startDate'));
    const now=new Date();
    const diffDays=Math.floor((now-startDate)/(1000*60*60*24));
    const currentMonth=Math.min(10,Math.floor(diffDays/30)+1);
    const levelIndex=Math.min(6,Math.ceil(currentMonth/(10/6)));
    const levels=['Anfänger','Amateur','Fortgeschrittener','Profi','Second AI Product Owner','AI Product Owner'];
    document.getElementById('xp').textContent=`${diffDays*100} XP`;
    document.getElementById('monthProgress').textContent=`${currentMonth} / 10`;
    document.getElementById('level').textContent=levels[levelIndex-1];

    // Google API (replace CLIENT_ID & API_KEY)
    const CLIENT_ID='<828803560489-gp7afdiddlv2iq10jttv48ufqrva7d27.apps.googleusercontent.com>'; const API_KEY='<AIzaSyASHlFIrs6AAxbO_Ac1utyBQqHLD6em_hQ>';
    const DISCOVERY_DOCS=['https://www.googleapis.com/discovery/v1/apis/calendar/v3/rest'];
    const SCOPES='https://www.googleapis.com/auth/calendar.events';
    const authorizeButton=document.getElementById('authorize_button');
    const signoutButton=document.getElementById('signout_button');
    function handleClientLoad(){gapi.load('client:auth2',initClient);}  
    function initClient(){
      gapi.client.init({apiKey:API_KEY,clientId:CLIENT_ID,discoveryDocs:DISCOVERY_DOCS,scope:SCOPES})
      .then(()=>{gapi.auth2.getAuthInstance().isSignedIn.listen(updateSigninStatus);updateSigninStatus(gapi.auth2.getAuthInstance().isSignedIn.get());authorizeButton.onclick=()=>gapi.auth2.getAuthInstance().signIn();signoutButton.onclick=()=>gapi.auth2.getAuthInstance().signOut();});
    }
    function updateSigninStatus(isSignedIn){if(isSignedIn){authorizeButton.style.display='none';signoutButton.style.display='inline-block';}else{authorizeButton.style.display='inline-block';signoutButton.style.display='none';}}
    window.onload=handleClientLoad;

    // Kalender & Tasks
    const calendarEl=document.getElementById('calendar');
    const taskSection=document.getElementById('taskSection');
    const backBtn=document.getElementById('backBtn');
    const taskForm=document.getElementById('taskForm');
    let selectedDate=null;
    const records=JSON.parse(localStorage.getItem('records')||'{}');
    const tasks=JSON.parse(localStorage.getItem('tasks')||'{}');
    const tasksDone=JSON.parse(localStorage.getItem('tasksDone')||'{}');

    function renderCalendar(){
      calendarEl.innerHTML='';
      const daysInMonth=new Date(now.getFullYear(),now.getMonth()+1,0).getDate();
      for(let d=1;d<=daysInMonth;d++){
        const day=new Date(now.getFullYear(),now.getMonth(),d);
        const dateStr=day.toISOString().slice(0,10);
        const el=document.createElement('div'); el.className='day';
        el.innerHTML=`<span class="date">${d}</span>`;
        const past=day<new Date().setHours(0,0,0,0);
        if(past) el.classList.add('past');
        if(records[dateStr]) el.classList.add('done');
        else if(past) el.classList.add('missed');
        el.onclick=()=>openTasks(dateStr);
        el.ondblclick=()=>{if(past){records[dateStr]=!records[dateStr];localStorage.setItem('records',JSON.stringify(records));renderCalendar();}};
        calendarEl.appendChild(el);
      }
    }
    renderCalendar();

    function openTasks(dateStr){
      selectedDate=dateStr;
      calendarEl.style.display='none';document.querySelector('.controls').style.display='none';taskSection.style.display='block';
      document.getElementById('taskDate').value=dateStr;
      renderTasks();
    }
    backBtn.onclick=()=>{calendarEl.style.display='grid';document.querySelector('.controls').style.display='flex';taskSection.style.display='none';};

    taskForm.onsubmit=e=>{
      e.preventDefault();
      const desc=document.getElementById('taskDesc').value;
      const date=document.getElementById('taskDate').value;
      const time=document.getElementById('taskTime').value;
      tasks[date]=tasks[date]||[];tasks[date].push({desc,time});
      localStorage.setItem('tasks',JSON.stringify(tasks));renderTasks();
    };

    function renderTasks(){
      const list=tasks[selectedDate]||[];
      const container=document.getElementById('tasksList');container.innerHTML='';
      list.forEach((t,i)=>{
        const div=document.createElement('div');div.className='task-item';
        const chk=document.createElement('input');chk.type='checkbox';chk.checked=tasksDone[selectedDate]?.[i];
        chk.onchange=()=>{tasksDone[selectedDate]=tasksDone[selectedDate]||[];tasksDone[selectedDate][i]=chk.checked;localStorage.setItem('tasksDone',JSON.stringify(tasksDone));if(tasksDone[selectedDate].filter(Boolean).length===list.length){records[selectedDate]=true;localStorage.setItem('records',JSON.stringify(records));renderCalendar();}};
        const span=document.createElement('span');span.textContent=`${t.desc} (${t.time})`;
        const addBtn=document.createElement('button');addBtn.textContent='→ Calendar';addBtn.onclick=()=>addEvent(t);
        div.append(chk,span,addBtn);container.appendChild(div);
      });
    }

    function addEvent(task){
      if(!gapi.auth2.getAuthInstance().isSignedIn.get())return alert('Bitte verbinden');
      const event={summary:task.desc,start:{dateTime:`${selectedDate}T${task.time}:00`,timeZone:Intl.DateTimeFormat().resolvedOptions().timeZone},end:{dateTime:`${selectedDate}T${task.time}:00`,timeZone:Intl.DateTimeFormat().resolvedOptions().timeZone}};
      gapi.client.calendar.events.insert({calendarId:'primary',resource:event}).then(()=>alert('Termin erstellt'));
    }
  </script>
</body>
</html>
